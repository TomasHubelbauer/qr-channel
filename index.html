<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>QR Channel</title>
    <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
    <script src="https://unpkg.com/qrcode-generator"></script>
    <style>
      #viewfinderVideo { display: none; }
      #sketchCanvas { height: 128px; }
      #codeCanvas {  }
    </style>
  </head>
  <body>
    <h1>QR Channel</h1>
    <video id="viewfinderVideo"></video>
    <canvas id="sketchCanvas"></canvas>
    <canvas id="codeCanvas"></canvas>
    <p id="messageP"></p>
    <script>
const viewfinderVideo = document.querySelector('#viewfinderVideo');
const sketchCanvas = document.querySelector('#sketchCanvas');
const codeCanvas = document.querySelector('#codeCanvas');
const messageP = document.querySelector('#messageP');
void async function() {
  const mediaStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
  viewfinderVideo.srcObject = mediaStream;
  // Set this attribute (not class member) through JavaScript (not HTML) to make iOS Safari work
  viewfinderVideo.setAttribute('playsinline', true);
  // Play within the `getUserMedia` gesture, `autoplay` won't work
  await viewfinderVideo.play();
  // Keep a reference to the context to refresh upon video size change
  let context;
  requestAnimationFrame(function tick() {
    if (viewfinderVideo.readyState === viewfinderVideo.HAVE_ENOUGH_DATA) {
      if (sketchCanvas.width !== viewfinderVideo.videoWidth || sketchCanvas.height !== viewfinderVideo.videoHeight) {
        sketchCanvas.width = viewfinderVideo.videoWidth;
        sketchCanvas.height = viewfinderVideo.videoHeight;
        context = sketchCanvas.getContext('2d');
      }

      context.drawImage(viewfinderVideo, 0, 0, viewfinderVideo.videoWidth, viewfinderVideo.videoHeight);
      const imageData = context.getImageData(0, 0, sketchCanvas.width, sketchCanvas.height);
      const code = jsQR(imageData.data, imageData.width, imageData.height);
      if (code !== null) {
        messageP.textContent = code.data;
      }
    }

    requestAnimationFrame(tick);
  });
}()
      
      const qr = qrcode(1, 'L');
      qr.addData('01234567890123456789', 'Numeric');
      qr.make();
      const cellSize = 15;
      codeCanvas.width = qrcode.getModuleCount() * cellSize;
      codeCanvas.height = qrcode.getModuleCount() * cellSize;
      qr.renderTo2dContext(codeCanvas.getContext('2d'), cellSize);
    </script>
  </body>
</html>
